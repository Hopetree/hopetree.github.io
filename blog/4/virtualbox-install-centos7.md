# VirtualBox 安装 CentOS 7 系统并通过主机 ssh 连接虚拟机

我自己的云服务器是 Ubuntu 系统，自己之前使用的本机虚拟机也都是 Ubuntu 系统，但是一般公司使用的多半是 CentOS 或者其他类似的系统，很少使用 Ubuntu 系统，而且我们公司也都是使用的基于 CentOS 的系统，所以为了更方便于自己将学到的东西应用到工作中，决定开始使用 CentOS 的虚拟机。

为了学习新的系统，使用 VirtualBox 创建虚拟机是我最为推荐的方式，不仅可以拥有一台跟服务器一样的操作系统，还可以随便测试任意操作，不用担心崩掉系统。以下就是我创建和配置一个 CentOS 的一些基本步骤。


## 创建虚拟机
### 下载系统镜像
CentOS 的系统镜像可以去一些开源的镜像站上下载，我这里使用的是阿里云的镜像站，地址是：<https://mirrors.aliyun.com/centos/7/isos/x86_64/>

### 虚拟机配置
创建虚拟电脑的过程这里不做太多介绍，根据自己的需要设置内存和磁盘大小这些数据就行，创建完成之后，启动虚拟机的时候会让你选择启动的镜像，这里直接选择之前下载好的系统镜像就行了，选择了之后就会开始执行系统安装。


## 系统安装
启动了 CentOS 的安装之后，可以看到一个如下截图的可以进行设置的界面：

![安装CentOS](https://tendcode.com/cdn/article/190131/tendcode_2019-01-31_22-04-56.png)

这里我只进行了3个设置，也就是截图中显示的。设置时区不用多说，一般都是设置成上海时区；系统分区的时候可以默认分区也可以自定义分区，这里我会选择自定义分区，具体可以看后续截图；最后的设置可以更改主机的名称，改成自己喜欢的就行，然后需要开启一下网络，不然虚拟机创建了不能联网的。

### 设置时区
直接看截图就行了，时区的设置跟之前的语言选择一样，都是看自己的需要，这里我选择了上海时区：

![CentOS时区设置](https://tendcode.com/cdn/article/190131/tendcode_2019-01-31_22-05-35.png)

### 系统分区
进入分区设置，首先会看到如下截图的显示，这里默认是选择的默认分区，给新手用的，虽然我对 CentOS 也不熟，但是一般我都是喜欢自定义，所以我选择自定义分区：

![CentOS系统分区](https://tendcode.com/cdn/article/190131/tendcode_2019-01-31_22-08-38.png)

为了能够更好的进行自定义分区，建议你先上网搜了一下关于各个分区的作用和一般分区原则，然后可以借鉴一下我下面的分区情况：

![CentOS系统分区](https://tendcode.com/cdn/article/190612/virtualbox-install-centos-7.png)

**建议分区**
以下是我实践之后重新确认的分区方案，以20GB为例：

```
/            17GB          必须；这个分区是实际使用的盘，不必要去细分
/boot      500MB       必须；这个分区是留给系统启动用的 ，大于200MB即可
swap      2GB           必须；这个分区是虚拟内存分区，大于物理内存即可
```

### 网络设置
设置系统的主机名称和网络设置可以看截图：

![CentOS网络设置](https://tendcode.com/cdn/article/190131/tendcode_2019-01-31_21-21-22.png)

默认的主机名称太长了，而且也不便于记录，所以自然是需要更换成自己设置的；网络设置这个地方如果只是想要开启网路的话，只需要打开截图中的按钮即可（默认是关闭的），这样虚拟机创建之后就可以上网了，如果需要设置更过网络配置，比如网卡 IP 之类的，可以点击右下角的设置按钮进入网络设置进行自定义设置，这些设置其实可以在后续系统安装完成之后再做，所以这里就不配置了。

### 添加用户和root密码
当前面的配置后已经配置完成之后，系统就已经开始安装了，这个过程中可以设置 root 的密码和添加一个用户，这个用户可以添加一下管理权限，作为管理用户使用。

![CentOS添加用户](https://tendcode.com/cdn/article/190131/tendcode_2019-01-31_22-57-48.png)

系统安装完成之后会提示系统需要重启，安装提示执行重启即可，至此，CentOS 的安装就可以全部完成了。

## 主机登录虚拟机
上面的步骤我们已经完成了 CentOS 的安装，安装结束之后会会让我们登录一下虚拟机，这里可以选择使用 root 用户登录也可以选择自己添加的那个用户登录，登录之后可以执行一些命令看看系统的状态，比如执行一下 ping 命令，看看网络是否可用，正常按照上述的步骤设置了之后网络是可以用的。

虽然上面的步骤执行完成之后虚拟机已经可以正常使用了，但是 CentOS 自定的命令行太难用了，界面不好看不说，复制粘贴也不方便，而且也不方便命令行窗口多开，所以我决定使用主机通过 ssh 去连接虚拟机，这样也方便管理，以下是设置的步骤：

### 打开 ssh 配置
首先，登录虚拟机，使用 root 用户修改 ssh 的配置文件，打开 ssh 连接，具体如下：

```shell
vi /etc/ssh/sshd_config
```

最简单的修改就是直接把注释掉的 22 端口那行的 `#` 去掉就行了，然后添加一个除了 root 之外可以登录的用户：
```shell
#
Port 22
#AddressFamily any
AllowUsers theusername
```

修改完配置之后，需要重启一下 sshd 服务，重启的命令如下：

```shell
/bin/systemctl restart sshd.service
```

### 设置 VirtualBox 网络模式

为了让主机和其他虚拟机可以相互登陆，可以把网络模式设置成“桥接模式”，然后把混杂模式设置成“全部允许”，具体设置看截图：

![端口转发](https://tendcode.com/cdn/article/190612/tendcode_2019-06-13_20-33-35.png)

网络设置好了之后，重启一下虚拟机，然后可以查看一下虚拟机的网络 IP，可以发现已经有了和主机同一个内网的网段 IP，这个 192.168 的 IP 地址就可以用来进行 SSH 登陆了

![虚拟机IP](https://tendcode.com/cdn/article/190612/tendcode_2019-06-13_20-41-15.png)

### ssh 连接
配置完成之后，可以试一下登录虚拟机，看看是不是可以登录上了（别忘了虚拟机首先是需要运行的），这里我登录上了，然后随便执行了一下 ping 命令：

![ping](https://tendcode.com/cdn/article/190131/tendcode_2019-01-31_23-33-56.png)

## 复制虚拟机
使用虚拟机可以搭建自己的虚拟机集群，这就会需要创建多个虚拟机，当然你可以一个一个的安装系统创建，不过，virtualbox 提供了复制虚拟机的方式，可以很快的使用已存在的虚拟机复制一台一模一样的虚拟机出来。

复制很简单，直接点击一个关闭状态的虚拟机，复制即可，给新虚拟机机取个名字，然后勾选重置网卡参数（这个非常重要，勾选这个才会重新生成IP），同时勾选完全复制:

![复制虚拟机](https://tendcode.com/cdn/article/190715/tendcode_2019-07-15_19-11-55.png)

![复制虚拟机2](https://tendcode.com/cdn/article/190715/tendcode_2019-07-15_19-12-04.png)

等待一段时间，虚拟机创建完成之后，可以查看一下新虚拟机的网卡信息，是否已经与原来的虚拟机不一样了：

![网卡信息](https://tendcode.com/cdn/article/190715/tendcode_2019-07-15_19-15-23.png)

然后可以登陆新的虚拟机查看IP信息，为了后续登陆虚拟机的方便识别，可以给新虚拟机更换一下名称（CentOS7 的方式）：

```
# root 用户执行
hostnamectl set-hostname centos-5
```

总结：以上就是全部的使用 VirtualBox 安装 contos 系统并设置 ssh 登录的一些操作。与之前我安装和配置 Ubuntu 系统相比，我觉得 CentOS 系统好像更简洁命令，毕竟是企业级别的系统，很多操作跟工作使用的系统一样，所有后续我会把 CentOS 当做主要的 Linux 系统进行使用。